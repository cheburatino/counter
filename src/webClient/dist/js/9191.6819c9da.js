"use strict";(self["webpackChunkElectron"]=self["webpackChunkElectron"]||[]).push([[9191],{39191:(t,e,l)=>{l.r(e),l.d(e,{default:()=>U});var i=l(34182);const s={style:{display:"flex",width:"100%","justify-content":"space-between","flex-wrap":"wrap"}},a={style:{display:"flex","justify-content":"space-between",width:"100%",padding:"5px"}},o=(0,i._)("img",{src:"image/task.svg",alt:""},null,-1),d=(0,i.Uk)(),r=(0,i._)("div",{class:"text-h6"},"Добавление нового фильтра",-1),n=(0,i._)("div",{class:"text-h8"},"Название фильтра:",-1),u=(0,i._)("div",{class:"text-h8"},"Условия фильтра:",-1),c=(0,i._)("div",{class:"text-h6"},"Редактирование фильтра",-1),m=(0,i._)("div",{class:"text-h8"},"Название фильтра:",-1),p=(0,i._)("div",{class:"text-h8"},"Условия фильтра:",-1),h={class:"q-ml-sm"};function w(t,e,l,w,_,f){const g=(0,i.up)("comp-breadcrumb"),F=(0,i.up)("q-input"),k=(0,i.up)("q-btn"),y=(0,i.up)("q-avatar"),C=(0,i.up)("q-item-section"),b=(0,i.up)("router-link"),W=(0,i.up)("q-item-label"),M=(0,i.up)("q-badge"),D=(0,i.up)("comp-item-dropdown-btn"),q=(0,i.up)("comp-doc-list"),x=(0,i.up)("q-card-section"),L=(0,i.up)("q-card-actions"),T=(0,i.up)("q-card"),V=(0,i.up)("q-dialog"),v=(0,i.up)("q-page"),S=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(v,{padding:!l.isOpenInDialog},{default:(0,i.w5)((()=>[l.isOpenInDialog?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(g,{key:0,class:"text-capitalize",list:[{label:t.$t("task.name_plural"),docType:"task"}]},null,8,["list"])),(0,i.Wm)(q,{ref:"docList",listTitle:t.$t("task.name_plural"),listDeletedTitle:t.$t("task.name_plural_deleted"),"pg-method":"task_list","list-sort-data":_.listSortData,"list-filter-data":_.listFilterData,newDocUrl:f.currentUrl+"new",ext:l.ext,"search-fld-name":"search_text",readonly:!1},{addFilterSlot:(0,i.w5)((()=>[(0,i._)("div",s,[(0,i.Wm)(F,{id:"sqlInput",onKeydown:f.keydownHandler,style:{width:"100%"},filled:"",modelValue:_.sqlRest,"onUpdate:modelValue":e[0]||(e[0]=t=>_.sqlRest=t),label:"Условия фильтра","input-class":"text-left"},null,8,["onKeydown","modelValue"]),(0,i._)("div",a,[(0,i._)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.filterList,(t=>((0,i.wg)(),(0,i.j4)(k,{key:t.id,color:"white",style:{"margin-right":"5px","margin-bottom":"5px"},"text-color":"primary",label:t.title,onClick:e=>f.filterStringAssembly(t.where_str),onMousedown:f.mousedownOnFilter,onMouseup:e=>f.mouseupOnFilter(t),onDblclick:e=>f.dblClickOnFilter(t)},null,8,["label","onClick","onMousedown","onMouseup","onDblclick"])))),128))]),(0,i._)("div",null,[(0,i.Wm)(k,{color:"black","text-color":"primary",label:"+",onClick:f.openCreateFilterModal},null,8,["onClick"])])])])])),listItem:(0,i.w5)((({item:l})=>[(0,i.Wm)(b,{to:f.currentUrl+l.id,style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{rounded:""},{default:(0,i.w5)((()=>[o])),_:1})])),_:1})])),_:2},1032,["to"]),(0,i.Wm)(C,null,{default:(0,i.w5)((()=>[(0,i.Wm)(W,{lines:"1"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,i.zw)(l.title),1)])),_:2},1024),(0,i.Wm)(W,{caption:""},{default:(0,i.w5)((()=>[(0,i.Wm)(M,{color:"orange"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,i.zw)(l.options.title.state_title),1)])),_:2},1024),d,(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,i.zw)(l.options.title.system_title),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,i.Wm)(C,{top:"",side:""},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{item:l,itemProp:"title","is-edit":!0,"is-delete":!0,fkProp:"","pg-method":"task_update",onEdit:e=>t.$router.push(`${f.currentUrl}${l.id}`),onReloadList:e[1]||(e[1]=e=>t.$refs.docList.reloadList())},null,8,["item","is-delete","onEdit"])])),_:2},1024)])),_:1},8,["listTitle","listDeletedTitle","list-sort-data","list-filter-data","newDocUrl","ext"]),(0,i.Wm)(V,{modelValue:_.isCreateFilterModal,"onUpdate:modelValue":e[4]||(e[4]=t=>_.isCreateFilterModal=t),"transition-show":"rotate","transition-hide":"rotate",persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{style:{"min-width":"350px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[r])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[n])),_:1}),(0,i.Wm)(x,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{dense:"",modelValue:_.newFilterTitle,"onUpdate:modelValue":e[2]||(e[2]=t=>_.newFilterTitle=t),autofocus:"",onKeyup:(0,i.D2)(f.closeCreateFilterModal,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[u])),_:1}),(0,i.Wm)(x,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{dense:"",modelValue:_.newFilterСondition,"onUpdate:modelValue":e[3]||(e[3]=t=>_.newFilterСondition=t),autofocus:"",onKeyup:(0,i.D2)(f.closeCreateFilterModal,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),(0,i.Wm)(L,{align:"right",class:"text-primary"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(k,{flat:"",label:"Cancel"},null,512),[[S]]),(0,i.Wm)(k,{flat:"",label:"Add filter",onClick:f.createFilter},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(V,{modelValue:_.isEditFilterModal,"onUpdate:modelValue":e[9]||(e[9]=t=>_.isEditFilterModal=t),"transition-show":"rotate","transition-hide":"rotate",persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{style:{"min-width":"350px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[c])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)(x,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{dense:"",modelValue:_.editFilterTitle,"onUpdate:modelValue":e[5]||(e[5]=t=>_.editFilterTitle=t),autofocus:"",onKeyup:e[6]||(e[6]=(0,i.D2)((()=>this.isEditFilterModal=!1),["enter"]))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[p])),_:1}),(0,i.Wm)(x,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{dense:"",modelValue:_.editFilterСondition,"onUpdate:modelValue":e[7]||(e[7]=t=>_.editFilterСondition=t),autofocus:"",onKeyup:e[8]||(e[8]=(0,i.D2)((()=>this.isEditFilterModal=!1),["enter"]))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(L,{align:"right",class:"text-primary"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(k,{flat:"",label:"Cancel"},null,512),[[S]]),(0,i.Wm)(k,{flat:"",label:"Edit filter",onClick:f.editFilter},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(V,{modelValue:_.isDeleteFilterModal,"onUpdate:modelValue":e[10]||(e[10]=t=>_.isDeleteFilterModal=t),"transition-show":"rotate","transition-hide":"rotate",persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(T,null,{default:(0,i.w5)((()=>[(0,i.Wm)(x,{class:"row items-center"},{default:(0,i.w5)((()=>[(0,i._)("span",h,'Хотите удалить фильтр "'+(0,i.zw)(_.curFilter.title)+'"?',1)])),_:1}),(0,i.Wm)(L,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(k,{flat:"",label:"Cancel",color:"primary"},null,512),[[S]]),(0,i.Wm)(k,{flat:"",label:"Delete",color:"primary",onClick:f.deleteFilter},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["padding"])}l(10071),l(66016);var _=l(43015);const f={props:["isOpenInDialog","ext"],mixins:[_.Z],computed:{currentUrl:()=>"/task/"},data(){return{listSortData:[{value:"created_at",title:"Дата"},{value:"title",title:"Название"}],listFilterData:[{value:{deleted:!1},title:"Активные"},{value:{deleted:!0},title:"Удаленные"}],filterCtlgTaskStateTitle:null,filterCtlgTaskStateId:null,filterSystemTitle:null,filterSystemId:null,filterDigitalSolutionTitle:null,filterDigitalSolutionId:null,sqlRest:"state_id != 4",sqlRestList:[],active:!0,isCreateFilterModal:!1,newFilterTitle:"",newFilterСondition:"",filterList:[],ismousedownOnFilter:!1,mouseFlag:!1,isDeleteFilterModal:!1,curFilter:"",filterLoading:!1,isEditFilterModal:!1,editFilterTitle:"",editFilterСondition:""}},methods:{dblClickOnFilter(t){this.curFilter=t,this.isEditFilterModal=!0,this.editFilterTitle=t.title,this.editFilterСondition=t.where_str},mousedownOnFilter(){this.filterLoading||(this.filterLoading=!0,this.mouseFlag=!1,setTimeout((()=>{this.mouseFlag=!0,this.filterLoading=!1}),1500))},mouseupOnFilter(t){this.mouseFlag&&(this.isDeleteFilterModal=!0,this.curFilter=t)},filterStringAssembly(t){this.mouseFlag||(this.sqlRest=t,this.sqlRestBtnClickHandler())},createFilter(){this.$utils.postCallPgMethod({method:"ctlg_filter_update",params:{id:-1,title:this.newFilterTitle,index:"task",where_str:this.newFilterСondition,user_table_id:this.currentUser.id}}).subscribe((t=>{t.ok&&(this.loadFilterList(),this.closeCreateFilterModal())}))},deleteFilter(){this.$utils.postCallPgMethod({method:"ctlg_filter_update",params:{id:this.curFilter.id,deleted:!0}}).subscribe((t=>{t.ok&&(this.loadFilterList(),this.isDeleteFilterModal=!1)}))},editFilter(){this.$utils.postCallPgMethod({method:"ctlg_filter_update",params:{id:this.curFilter.id,title:this.editFilterTitle,index:"task",where_str:this.editFilterСondition,user_table_id:this.currentUser.id}}).subscribe((t=>{t.ok&&(this.loadFilterList(),this.isEditFilterModal=!1)}))},loadFilterList(){this.$utils.postCallPgMethod({method:"ctlg_filter_list",params:{user_table_id:this.currentUser.id,index:"task"}}).subscribe((t=>{t.ok&&(console.log("filterList: ",t.result),this.filterList=t.result)}))},openCreateFilterModal(){this.isCreateFilterModal=!0},closeCreateFilterModal(){this.isCreateFilterModal=!1,this.newFilterTitle="",this.newFilterСondition=""},sqlRestBtnClickHandler(){this.$refs.docList.changeItemList({where_param:this.sqlRest?this.sqlRest:null})},keydownHandler(t){13==t.keyCode&&this.sqlRestBtnClickHandler()},routOnTask(t){console.log(window.location),console.log(t),window.location.href=`${window.location.origin}${window.location.pathname}/${t}`},updateFilterCtlgTaskState(t){this.$refs.docList.changeItemList({state:t?t.id:null}),t&&this.$utils.callPgMethod("ctlg_task_state_get_by_id",{id:t.id},(t=>{this.filterCtlgTaskStateTitle=t.title}))},updateFilterSystem(t){this.$refs.docList.changeItemList({system_id:t?t.id:null}),t&&this.$utils.callPgMethod("system_get_by_id",{id:t.id},(t=>{this.filterSystemTitle=t.title}))},updateFilterDigitalSolution(t){this.$refs.docList.changeItemList({digital_solution_id:t?t.id:null}),t&&this.$utils.callPgMethod("digital_solution_get_by_id",{id:t.id},(t=>{this.filterDigitalSolutionTitle=t.title}))}},mounted(){const t=new URLSearchParams(window.location.search);if(t.has("state")){let e=+t.get("state");e&&this.updateFilterCtlgTaskState({id:e})}if(t.has("system_id")){let e=+t.get("system_id");e&&this.updateFilterSystem({id:e})}if(t.has("digital_solution_id")){let e=+t.get("digital_solution_id");e&&this.updateFilterDigitalSolution({id:e})}this.sqlRestBtnClickHandler(),this.loadFilterList()}};var g=l(74260),F=l(24379),k=l(34842),y=l(2165),C=l(52035),b=l(75096),W=l(2350),M=l(69721),D=l(46778),q=l(10151),x=l(25589),L=l(99367),T=l(60677),V=l(7518),v=l.n(V);const S=(0,g.Z)(f,[["render",w]]),U=S;v()(f,"components",{QPage:F.Z,QInput:k.Z,QBtn:y.Z,QItemSection:C.Z,QAvatar:b.Z,QItemLabel:W.Z,QBadge:M.Z,QDialog:D.Z,QCard:q.Z,QCardSection:x.Z,QCardActions:L.Z}),v()(f,"directives",{ClosePopup:T.Z})}}]);